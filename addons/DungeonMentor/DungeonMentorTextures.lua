-- <a href="https://www.freepik.com/icon/healthy-food_8326598#position=47&page=1&term=eating&fromView=search">Icon by pikslgrafik</a>
-- <a href="https://www.freepik.com/icon/potion_7860322#position=1&page=1&term=potion&fromView=search">Icon by Culmbio</a>
-- <a href="https://www.freepik.com/icon/spoon-fork_3683875#position=23&page=1&term=food&fromView=search">Icon by Sohell</a>
-- <a href="https://www.freepik.com/icon/root_3239230#position=5&page=1&term=roots&fromView=search">Icon by dDara</a>
-- <a href="https://www.freepik.com/icon/chat_510397#position=63&page=2&term=chat&fromView=search">Icon by Dreamstale</a>
-- <a href="https://www.freepik.com/icon/close_7786357#position=44&page=1&term=x&fromView=search">Icon by sonnycandra</a>
-- <a href="https://www.freepik.com/icon/right_4682277#position=67&page=1&term=next&fromView=search">Icon by Wahyu Adam</a>
-- <a href="https://www.freepik.com/icon/right_4682277#position=67&page=1&term=next&fromView=search">Icon by Wahyu Adam</a>
-- <a href="https://www.freepik.com/icon/link_8637814#position=13&page=3&term=link&fromView=search">Icon by bsd</a>
-- <a href="https://www.freepik.com/icon/more_3161837#position=19&page=2&term=new&fromView=search">Icon by reussy</a>
-- <a href="https://www.freepik.com/icon/go-back-arrow_13964#position=4&page=1&term=undo&fromView=search">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/register_4990673#position=1&page=1&term=rename&fromView=search">Icon by wahya</a>
-- <a href="https://www.freepik.com/icon/map_1020267">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/healthy-food_8326598#position=47&page=1&term=eating&fromView=search">Icon by pikslgrafik</a>
-- <a href="https://www.freepik.com/icon/potion_7860322#position=1&page=1&term=potion&fromView=search">Icon by Culmbio</a>
-- <a href="https://www.freepik.com/icon/spoon-fork_3683875#position=23&page=1&term=food&fromView=search">Icon by Sohell</a>
-- <a href="https://www.freepik.com/icon/root_3239230#position=5&page=1&term=roots&fromView=search">Icon by dDara</a>
-- <a href="https://www.freepik.com/icon/chat_510397#position=63&page=2&term=chat&fromView=search">Icon by Dreamstale</a>
-- <a href="https://www.freepik.com/icon/close_7786357#position=44&page=1&term=x&fromView=search">Icon by sonnycandra</a>
-- <a href="https://www.freepik.com/icon/right_4682277#position=67&page=1&term=next&fromView=search">Icon by Wahyu Adam</a>
-- <a href="https://www.freepik.com/icon/right_4682277#position=67&page=1&term=next&fromView=search">Icon by Wahyu Adam</a>
-- <a href="https://www.freepik.com/icon/link_8637814#position=13&page=3&term=link&fromView=search">Icon by bsd</a>
-- <a href="https://www.freepik.com/icon/teacher_3471309#fromView=search&term=teacher&page=1&position=73">Icon by kmg design</a>
-- <a href="https://www.freepik.com/icon/map_2893128#fromView=search&term=map&page=2&position=11">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/vision_4129777#fromView=search&term=eye&page=1&position=13&track=ais">Icon by lakonicon</a>
-- <a href="https://www.freepik.com/icon/flash_252851#fromView=search&term=bolt&page=1&position=21&track=ais">Icon by Smashicons</a>
-- <a href="https://www.freepik.com/icon/cloak_5046399#fromView=search&term=cloak&page=3&position=5&track=ais">Icon by AngDiz</a>
-- <a href="https://www.freepik.com/icon/warning_497789#fromView=search&term=caution&page=1&position=7&track=ais">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/timer_7154507#fromView=search&term=fast+time&page=5&position=19&track=ais">Icon by Anggara</a>
-- <a href="https://www.freepik.com/icon/wings_7807031#fromView=search&term=angel&page=2&position=52&track=ais">Icon by Icon Hubs</a>
-- <a href="https://www.freepik.com/icon/man_4978619">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/warning_3503942#fromView=search&term=warning&page=1&position=3&track=ais">Icon by Tempo_doloe</a>
-- <a href="https://www.freepik.com/icon/angel_1854311#fromView=search&term=wings&page=1&position=37&track=ais">Icon by Freepik</a>
-- <a href="https://www.freepik.com/icon/repeat_275197#fromView=search&term=replay&page=1&position=0&track=ais">Icon by Smashicons</a>
-- <a href="https://www.freepik.com/icon/skull_3904711#fromView=search&term=skull&page=1&position=27&track=ais">Icon by Victoruler</a>

local mainInterfaceIconsTextureFile = "Interface\\AddOns\\DungeonMentor\\textures\\main_interface_icons1";

local mainInterfaceIcons = {
   sourceImageWidth = 2048,
   iconWidth = 128,
   iconHeight = 128,
   horizCount = 10,
   vertCount = 1
};

local routeBuilderIconsTextureFile = "Interface\\AddOns\\DungeonMentor\\textures\\main_interface_icons2";

local routeBuilderIconFileInfo = {
    sourceImageWidth = 2048,
    iconWidth = 128,
    iconHeight = 128,
    horizCount = 16,
    vertCount = 1
};

local mapMobIconTextFiles = {
    [1] = "Interface\\AddOns\\DungeonMentor\\textures\\area_mob_markers_normal.png",
    [2] = "Interface\\AddOns\\DungeonMentor\\textures\\area_mob_markers_highlighted.png",
};

local environmentPoiTextureFile = "Interface\\AddOns\\DungeonMentor\\textures\\map_env_markers";

local envMarkersFileInfo = {
    sourceImageWidth = 512,
    sourceImageHeight = 512,
    iconWidth = 32,
    iconHeight = 32,
    horizCount = 9,
    vertCount = 6
};

local setButtonFile = "Interface\\AddOns\\DungeonMentor\\textures\\activate_route_button";

local routeItemsTextureFile = "Interface\\AddOns\\DungeonMentor\\textures\\special_route_items";

local routeItemsFileInfo = {
    sourceImageWidth = 2048,
    sourceImageHeight = 512,
    iconWidth = 128,
    iconHeight = 128,
    horizCount = 16,
    vertCount = 2
};

function DM_Tex_CreateSetButton(frame)
    local setButtonTexture = frame:CreateTexture(nil, mapDrawLayer, nil, 0);
    frame.setButton = setButtonTexture;
    local objectDrawLayer = "OVERLAY";
    local drawLayer = 7;

    setButtonTexture:SetDrawLayer(objectDrawLayer, drawLayer);
    setButtonTexture:SetTexture(setButtonFile);
    -- left, right, top, bottom
    setButtonTexture:SetTexCoord(0, 1, 0, 0.5);

    return setButtonTexture;
end

function DM_Tex_SetSetButtonHighlighted(b)
    b:SetTexCoord(0, 1, 0.5, 1);
end

function DM_Tex_SetSetButtonNormal(b)
    b:SetTexCoord(0, 1, 0, 0.5);
end

function DM_Tex_CreateMapEnvIcon(frame, envMarkerPrefix, num, isHighlighted, cacheKey)
    local envMarker = envMarkerPrefix .. tostring(num);

    if frame.cachedEnvIcons and frame.cachedEnvIcons[cacheKey or envMarker] then
        return frame.cachedEnvIcons[cacheKey or envMarker]; -- todo: likely need to set texture file based on highlight level, just in case of a disparity
    end

    local markerToRow = {["G"]=0, ["T"]=2, ["S"]=4};

    local texFile = environmentPoiTextureFile;

    local iconWidth = 32;
    local iconHeight = 32;
    local numIconsAcross = 16;
    local numIconsVert = 8;
    local pixelsAcross = iconWidth*numIconsAcross;
    local pixelsVert = iconHeight*numIconsVert;

    -- (r,c) is (1,1) at top left in image file, we want (0,0) for the math below
    local icon_x_index = num - 1;
    local icon_y_index = markerToRow[envMarkerPrefix];

    if isHighlighted then
        icon_y_index = icon_y_index + 1;
    end

    local envMarkerIcon = frame:CreateTexture(nil, mapDrawLayer, nil, 0);
    local objectDrawLayer = "OVERLAY";
    local drawLayer = 7;
    envMarkerIcon:SetDrawLayer(objectDrawLayer, drawLayer);

    envMarkerIcon:SetTexture(texFile);

    envMarkerIcon:SetTexCoord((icon_x_index*iconWidth) / pixelsAcross, ((icon_x_index+1)*iconWidth)/pixelsAcross, (icon_y_index*iconHeight) / pixelsVert, ((icon_y_index+1)*iconHeight)/pixelsVert);

    if frame.cachedEnvIcons == nil then
        frame.cachedEnvIcons = {};
    end

    frame.cachedEnvIcons[cacheKey or envMarker] = envMarkerIcon;

    return envMarkerIcon;
end

function DM_Tex_CreateGraveyard(frame)
    local tex = frame:CreateTexture(nil, drawLayer or "OVERLAY", nil, 0);

    tex:SetTexture(environmentPoiTextureFile);
    tex:SetWidth(16);
    tex:SetHeight(16);
    tex:SetTexCoord(0, 1, 0, 1);

    return tex;
end

local mainIcons = {
    ["GHOST"] = 1,
    ["MANA"] = 2,
    ["FOOD"] = 3,
    ["AFK"] = 4,
    ["ROOTS"] = 5,
    ["CHAT"] = 6,
    ["SKULL"] = 7,
    ["CIRCLE_X"] = 8,
    ["CIRCLE_NEXT"] = 9,
    ["CIRCLE_PREV"] = 10,
    ["X"] = 11,
    ["STOPLIGHT"] = 12,
    ["BOX"] = 13,
    ["BIG_X"] = 14
};

local routeBuilderIcons = {
   ["DOWN_ARROW"] = 1,
   ["UP_ARROW"] = 2,
   ["CIRCLE_X"] = 3,
   ["SAVE"] = 4,
   ["COPY"] = 5,
   ["PASTE"] = 6,
   ["SHARE"] = 7,
   ["X"] = 8,
   ["NOTE"] = 9,
   ["NUMBER"] = 10,
   ["GHOST"] = 11,
   ["CHAIN_LINKED"] = 12,
   ["CHAIN_UNLINKED"] = 13,
   ["NEW"] = 14,
   ["UNDO"] = 15,
   ["CHAIN_LINKED_FLIPPED"] = 16,
   ["RENAME"] = 17,
   ["MAP"] = 18,
   ["BIG_X"] = 19,
   ["RIGHT_ARROW"] = 20,
   ["CAUTION"] = 21,
   ["WINGS"] = 22,
   ["NUMBER_FILLED"] = 23,
   ["BOX"] = 24,
   ["INNER_BOX"] = 25,
   ["DIAMOND"] = 26
};

local routeItemIcons = {
    ["CAUTION"] = 1,
    ["LUST"] = 2,
    ["STEALTH"] = 3,
    ["LOS"] = 4,
    ["UNLINKED"] = 5,
    ["PULLCHAIN_LINKED"] = 6,
    ["PULLCHAIN_START"] = 7,
};

function DM_Tex_GetRouteItemIconCoords(iconName)
    local iconIndex = routeItemIcons[iconName];

    if iconIndex == nil then
        print("invalid icon name: " .. iconName);
        return nil;
    end

    return { left=( (iconIndex-1)*routeItemsFileInfo.iconWidth )/(routeItemsFileInfo.sourceImageWidth), 
             right=(iconIndex*routeItemsFileInfo.iconWidth)/(routeItemsFileInfo.sourceImageWidth), 
             top=0, 
             bottom=0.5 };
end

function DM_Tex_CreateRouteItemIcon(frame, iconName, width, height, drawLayer)
    local c = DM_Tex_GetRouteItemIconCoords(iconName);

    if c == nil then
        return nil;
    end

    local tex = frame:CreateTexture(nil, drawLayer or "OVERLAY", nil, 0);

    tex:SetTexture(routeItemsTextureFile);
    tex:SetWidth(width or 16);
    tex:SetHeight(height or 16);
    tex:SetTexCoord(c.left, c.right, c.top, c.bottom);

    return tex;
end

function DM_Tex_GetMainIconCoords(iconName)
    local iconIndex = mainIcons[iconName];

    if iconIndex == nil then
        print("invalid icon name: " .. iconName);
        return nil;
    end

    return { left=( (iconIndex-1)*mainInterfaceIcons.iconWidth )/(mainInterfaceIcons.sourceImageWidth), right=(iconIndex*mainInterfaceIcons.iconWidth)/(mainInterfaceIcons.sourceImageWidth), top=0, bottom=1 };
end

function DM_Tex_CreateMainIcon(frame, iconName, width, height, drawLayer)
    local c = DM_Tex_GetMainIconCoords(iconName);

    if c == nil then
        return nil;
    end

    local tex = frame:CreateTexture(nil, drawLayer or "OVERLAY", nil, 0);

    tex:SetTexture(mainInterfaceIconsTextureFile);
    tex:SetWidth(width or 16);
    tex:SetHeight(height or 16);
    tex:SetTexCoord(c.left, c.right, c.top, c.bottom);

    return tex;
end

function DM_Tex_GetRouteBuilderIconCoords(iconName)
    local iconIndex = routeBuilderIcons[iconName];

    if iconIndex == nil then
        print("invalid icon name: " .. iconName);
        return nil;
    end

    local t = 0;
    local b = 0.5;

    if iconIndex > 16 then
        iconIndex = iconIndex - 16;
        t = 0.5;
        b = 1.0;
    end
    
    return { left=( (iconIndex-1)*routeBuilderIconFileInfo.iconWidth )/(routeBuilderIconFileInfo.sourceImageWidth), right=(iconIndex*routeBuilderIconFileInfo.iconWidth)/(routeBuilderIconFileInfo.sourceImageWidth), top=t, bottom=b };
end

-- /script print(CreateAtlasMarkup("poi-graveyard-neutral"), "poi-graveyard-neutral")
function DM_Tex_CreateRouteBuilderIcon(frame, iconName, width, height, drawLayer)
    local c = DM_Tex_GetRouteBuilderIconCoords(iconName);

    if c == nil then
        return nil;
    end

    local tex = frame:CreateTexture(nil, drawLayer or "OVERLAY", nil, 0);

    tex:SetTexture(routeBuilderIconsTextureFile);
    tex:SetWidth(width or 16);
    tex:SetHeight(height or 16);
    tex:SetTexCoord(c.left, c.right, c.top, c.bottom);

    return tex;
end

function DM_Tex_ChangeRouteBuilderIcon(tex, iconName)
    local c = DM_Tex_GetRouteBuilderIconCoords(iconName);

    tex:SetTexCoord(c.left, c.right, c.top, c.bottom);
end

function DM_Tex_MobGroupToRowCol(mobGroup)
    if #mobGroup == 1 then
        return 1, string.byte(mobGroup, 1) - 64;
    else
        return string.byte(mobGroup, 1) - 63, string.byte(mobGroup, 2) - 64;
    end
end

function DM_Tex_GetPullGroupTextureFile(highlightLevel)
    return mapMobIconTextFiles[highlightLevel or 1];
end

function DM_Tex_SetPullGroupIconNormal(icon)
    icon:SetTexture(mapMobIconTextFiles[1]);
end

function DM_Tex_SetPullGroupIconHighlighted(icon)
    icon:SetTexture(mapMobIconTextFiles[2]);
end

function DM_Tex_CreateMapPullGroupIcon(frame, areaIndex, mobGroup, highlightLevel)
    local texFile = mapMobIconTextFiles[highlightLevel or 1];
    local r = areaIndex + 1; -- TODO: cheating temporarily, will fix below math later

    -- todo: there's a chance we'll overflow Z at some point, the
    --       texture file goes up to AF right now (26 + 6 additional to hit 32 across).
    --       until we do we'll cheat here
    local c = string.byte(mobGroup, 1) - 64;

    local iconWidth = 64;
    local iconHeight = 64;
    local numIconsAcross = 32;
    local numIconsVert = 16;
    local pixelsAcross = iconWidth*numIconsAcross;
    local pixelsVert = iconHeight*numIconsVert;

    -- (r,c) is (1,1) at top left in image file, we want (0,0) for the math below
    local icon_x_index = c - 1;
    local icon_y_index = r - 1;

    local mapMobGroupMarker = frame:CreateTexture(nil, mapDrawLayer, nil, 0);
    local objectDrawLayer = "OVERLAY";
    local drawLayer = 7;
    mapMobGroupMarker:SetDrawLayer(objectDrawLayer, drawLayer);

    mapMobGroupMarker:SetTexture(texFile);

    mapMobGroupMarker:SetTexCoord((icon_x_index*iconWidth) / pixelsAcross, ((icon_x_index+1)*iconWidth)/pixelsAcross, (icon_y_index*iconHeight) / pixelsVert, ((icon_y_index+1)*iconHeight)/pixelsVert);

    return mapMobGroupMarker;
end

function DM_Tex_CreateBlizzardAtlasTexture(frame, textureName)
    local grave = frame:CreateTexture();

    grave:SetPoint("CENTER");
    grave:SetAtlas("poi-graveyard-neutral", true);

    return grave;
end

function DM_Tex_CreateGraveyardIcon(frame)
    return DM_Tex_CreateBlizzardAtlasTexture("poi-graveyard-neutral");
end

function DM_Tex_CreateBackdrop(insetLeft, insetRight, insetTop, insetBottom)
    return {
        bgFile = "Interface/Tooltips/UI-Tooltip-Background",
        tile = true,
        tileSize = 64,
        edgeFile = "Interface\\AddOns\\DungeonMentor\\textures\\metallic_blue_frame_edges",
        edgeSize = 16,
        insets = { left = insetLeft or 4, right = insetRight or 1, top = insetTop or 1, bottom = insetBottom or 1 }
   };
end

function DM_Tex_StatusBarTexture()
    return "Interface\\Addons\\DungeonMentor\\textures\\minimalist_statusbar";
end
